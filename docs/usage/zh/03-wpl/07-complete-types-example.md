# WPL å®Œæ•´ç±»å‹ç³»ç»Ÿç¤ºä¾‹

> ä¸€ä¸ªç¤ºä¾‹å±•ç¤º WPL æ”¯æŒçš„æ‰€æœ‰ä¸»è¦æ•°æ®ç±»å‹

æœ¬æ–‡æ¡£æä¾›ä¸€ä¸ªå®Œæ•´çš„ã€å¯è¿è¡Œçš„ WPL è§„åˆ™ç¤ºä¾‹ï¼Œå±•ç¤º 23 ç§ä¸»è¦æ•°æ®ç±»å‹çš„ä½¿ç”¨æ–¹æ³•ã€‚è¿™æ˜¯å­¦ä¹  WPL ç±»å‹ç³»ç»Ÿçš„**æœ€ä½³å‚è€ƒ**ã€‚

---

## ğŸ“‘ æ–‡æ¡£å¯¼èˆª

| ç« èŠ‚ | è¯´æ˜ |
|------|------|
| [ç±»å‹è¦†ç›–æ¸…å•](#-ç±»å‹è¦†ç›–æ¸…å•) | æœ¬ç¤ºä¾‹åŒ…å«çš„æ‰€æœ‰ç±»å‹ |
| [å®Œæ•´ç¤ºä¾‹](#-å®Œæ•´ç¤ºä¾‹) | è¾“å…¥æ•°æ®ã€WPL è§„åˆ™ã€è¾“å‡ºç»“æœ |
| [ç±»å‹è¯¦è§£](#-ç±»å‹è¯¦è§£) | æ¯ç§ç±»å‹çš„è¯¦ç»†è¯´æ˜ |
| [ä½¿ç”¨å»ºè®®](#-ä½¿ç”¨å»ºè®®) | å­¦ä¹ è·¯å¾„å’Œå®æˆ˜å»ºè®® |
| [å¿«é€Ÿå¯¼èˆª](#-å¿«é€Ÿå¯¼èˆª) | å¿«é€Ÿè·³è½¬åˆ°éœ€è¦çš„å†…å®¹ |

---

## ğŸ“‹ ç±»å‹è¦†ç›–æ¸…å•

æœ¬ç¤ºä¾‹åŒ…å«ä»¥ä¸‹ç±»å‹ï¼š

| ç±»åˆ« | åŒ…å«ç±»å‹ | æ•°é‡ |
|------|---------|------|
| **åŸºç¡€ç±»å‹** | `peek_symbol`ã€`symbol`ã€`bool`ã€`chars`ã€`digit`ã€`float`ã€`_` | 7 |
| **æ—¶é—´ç±»å‹** | `time_3339`ã€`time_2822`ã€`time/clf`ã€`time_timestamp` | 4 |
| **ç½‘ç»œç±»å‹** | `ip`ã€`ip_net`ã€`port` | 3 |
| **ç»“æ„åŒ–ç±»å‹** | `kvarr`ã€`json` | 2 |
| **åè®®ç±»å‹** | `http/request`ã€`http/status`ã€`http/agent`ã€`http/method` | 4 |
| **ç¼–ç ç±»å‹** | `hex`ã€`base64` | 2 |
| **ç‰¹æ®Šç±»å‹** | `sn` | 1 |
| **æ€»è®¡** | | **23 ç§ç±»å‹** |

---

## ğŸš€ å®Œæ•´ç¤ºä¾‹

### è¾“å…¥æ•°æ®

```
peek_symbol symbol true "hello world" 123 3.14 2026-01-19T12:34:56Z 2022-03-21T12:34:56+00:00 Mon, 07 Jul 2025 09:20:32 +0000 [06/Aug/2019:12:12:19 +0800] 1647849600 192.168.1.100 192.168.0.0/24 name=test {"strict":true} "GET /api/users HTTP/1.1" 200 "Mozilla/5.0" "POST" 8080 ABC123XYZ 0x1A2B YmFzZTY0ZGF0YQ==
```

### WPL è§„åˆ™

```wpl
package wpl_example {
  rule full_types {
    (
      // 1. peek_symbol - é¢„è¯»ç¬¦å·ï¼ˆä¸æ¶ˆè´¹ï¼‰
      peek_symbol(peek_symbol):peek_sym,

      // 2. symbol - ç²¾ç¡®åŒ¹é…ç¬¦å·
      symbol(symbol):sym,

      // 3. bool - å¸ƒå°”å€¼
      bool:bool_val,

      // 4. chars - å­—ç¬¦ä¸²ï¼ˆå¸¦å¼•å·ï¼‰
      chars":quoted_str,

      // 5. digit - æ•´æ•°
      digit:integer,

      // 6. float - æµ®ç‚¹æ•°
      float:float_val,

      // 7. time_3339 - ISO 8601 / RFC3339
      time_3339:time_iso,

      // 8. time_3339 - RFC3339ï¼ˆå¸¦æ—¶åŒºï¼‰
      time_3339:time_rfc3339,

      // 9. time_2822 - RFC2822ï¼ˆé‚®ä»¶æ—¶é—´æ ¼å¼ï¼‰
      time_2822:time_rfc2822,

      // 10. time/clf - Common Log Formatï¼ˆApache/Nginxï¼‰
      time/clf<[,]>:time_clf,

      // 11. time_timestamp - Unix æ—¶é—´æˆ³
      time_timestamp:timestamp,

      // 12. ip - IP åœ°å€
      ip:ip_addr,

      // 13. ip_net - IP ç½‘æ®µï¼ˆCIDRï¼‰
      ip_net:ip_network,

      // 14. kvarr - é”®å€¼å¯¹
      kvarr(chars@name):kv_data,

      // 15. json - JSON å¯¹è±¡
      json(bool@strict):json_data,

      // 16. http/request - HTTP è¯·æ±‚è¡Œ
      http/request":http_req,

      // 17. http/status - HTTP çŠ¶æ€ç 
      http/status:http_status,

      // 18. http/agent - User-Agent
      http/agent":user_agent,

      // 19. http/method - HTTP æ–¹æ³•
      http/method":http_method,

      // 20. port - ç«¯å£å·
      port:port_num,

      // 21. sn - åºåˆ—å·
      sn:serial,

      // 22. hex - åå…­è¿›åˆ¶
      hex:hex_data,

      // 23. base64 - Base64 ç¼–ç 
      base64:base64_data
    )
  }
}
```

### è¾“å‡ºç»“æœ

```json
{
  "peek_sym": "peek_symbol",
  "sym": "symbol",
  "bool_val": true,
  "quoted_str": "hello world",
  "integer": 123,
  "float_val": 3.14,
  "time_iso": "2026-01-19 12:34:56",
  "time_rfc3339": "2022-03-21 12:34:56",
  "time_rfc2822": "2025-07-07 09:20:32",
  "time_clf": "2019-08-06 12:12:19",
  "timestamp": 1647849600,
  "ip_addr": "192.168.1.100",
  "ip_network": "192.168.0.0/24",
  "kv_data": {"name": "test"},
  "json_data": {"strict": true},
  "http_req": "GET /api/users HTTP/1.1",
  "http_status": 200,
  "user_agent": "Mozilla/5.0",
  "http_method": "POST",
  "port_num": 8080,
  "serial": "ABC123XYZ",
  "hex_data": "0x1A2B",
  "base64_data": "YmFzZTY0ZGF0YQ=="
}
```

---

## ğŸ“– ç±»å‹è¯¦è§£

### åŸºç¡€ç±»å‹

#### 1. peek_symbol - é¢„è¯»ç¬¦å·
```wpl
peek_symbol(peek_symbol):peek_sym
```
- **ä½œç”¨**ï¼šé¢„è¯»åŒ¹é…ä½†ä¸æ¶ˆè´¹è¾“å…¥
- **ç”¨é€”**ï¼šç”¨äºå‘å‰æŸ¥çœ‹è€Œä¸å½±å“åç»­è§£æ

#### 2. symbol - ç²¾ç¡®åŒ¹é…ç¬¦å·
```wpl
symbol(symbol):sym
```
- **ä½œç”¨**ï¼šç²¾ç¡®åŒ¹é…æŒ‡å®šå­—ç¬¦ä¸²
- **ç”¨é€”**ï¼šåŒ¹é…å›ºå®šå…³é”®å­—ã€åˆ†éš”ç¬¦ç­‰

#### 3. bool - å¸ƒå°”å€¼
```wpl
bool:bool_val
```
- **åŒ¹é…**ï¼š`true` æˆ– `false`
- **è¾“å‡º**ï¼šå¸ƒå°”ç±»å‹

#### 4. chars - å­—ç¬¦ä¸²
```wpl
chars":quoted_str
```
- **æ ¼å¼**ï¼šæ”¯æŒå¼•å·åŒ…è£¹ `"hello"` æˆ–è£¸å­—ç¬¦ä¸² `hello`
- **ç”¨é€”**ï¼šæå–ä»»æ„å­—ç¬¦ä¸²

#### 5. digit - æ•´æ•°
```wpl
digit:integer
```
- **åŒ¹é…**ï¼šæ•´æ•°ï¼Œå¦‚ `123`ã€`-456`
- **è¾“å‡º**ï¼šæ•´æ•°ç±»å‹

#### 6. float - æµ®ç‚¹æ•°
```wpl
float:float_val
```
- **åŒ¹é…**ï¼šæµ®ç‚¹æ•°ï¼Œå¦‚ `3.14`ã€`-0.5`
- **è¾“å‡º**ï¼šæµ®ç‚¹æ•°ç±»å‹

---

### æ—¶é—´ç±»å‹

#### 7-8. time_3339 - RFC3339/ISO 8601
```wpl
time_3339:time_iso           // 2026-01-19T12:34:56Z
time_3339:time_rfc3339       // 2022-03-21T12:34:56+00:00
```
- **æ ¼å¼**ï¼šISO 8601 / RFC3339 æ ‡å‡†
- **æ”¯æŒ**ï¼šå¸¦æ—¶åŒºæˆ–ä¸å¸¦æ—¶åŒº

#### 9. time_2822 - RFC2822ï¼ˆé‚®ä»¶æ—¶é—´ï¼‰
```wpl
time_2822:time_rfc2822
```
- **æ ¼å¼**ï¼š`Mon, 07 Jul 2025 09:20:32 +0000`
- **ç”¨é€”**ï¼šé‚®ä»¶å¤´ã€RSS ç­‰

#### 10. time/clf - Common Log Format
```wpl
time/clf<[,]>:time_clf
```
- **æ ¼å¼**ï¼š`[06/Aug/2019:12:12:19 +0800]`
- **ç”¨é€”**ï¼šApache/Nginx æ—¥å¿—

#### 11. time_timestamp - Unix æ—¶é—´æˆ³
```wpl
time_timestamp:timestamp
```
- **æ ¼å¼**ï¼šç§’çº§æ—¶é—´æˆ³ï¼Œå¦‚ `1647849600`
- **è¾“å‡º**ï¼šæ—¶é—´ç±»å‹

---

### ç½‘ç»œç±»å‹

#### 12. ip - IP åœ°å€
```wpl
ip:ip_addr
```
- **æ”¯æŒ**ï¼šIPv4ï¼ˆ`192.168.1.100`ï¼‰å’Œ IPv6ï¼ˆ`::1`ï¼‰

#### 13. ip_net - IP ç½‘æ®µ
```wpl
ip_net:ip_network
```
- **æ ¼å¼**ï¼šCIDR è¡¨ç¤ºæ³•ï¼Œå¦‚ `192.168.0.0/24`

#### 14. port - ç«¯å£å·
```wpl
port:port_num
```
- **èŒƒå›´**ï¼š1-65535

---

### ç»“æ„åŒ–ç±»å‹

#### 15. kvarr - é”®å€¼å¯¹
```wpl
kvarr(chars@name):kv_data
```
- **æ ¼å¼**ï¼š`key=value`
- **æ”¯æŒ**ï¼šè‡ªåŠ¨è§£ææˆ–æŒ‡å®šé”®æå–
- **ç¤ºä¾‹**ï¼š`name=test` â†’ `{name: "test"}`

#### 16. json - JSON å¯¹è±¡
```wpl
json(bool@strict):json_data
```
- **æ”¯æŒ**ï¼šå®Œæ•´ JSON è§£æ
- **å­å­—æ®µ**ï¼šå¯æå–åµŒå¥—å­—æ®µ
- **ç¤ºä¾‹**ï¼š`{"strict":true}` â†’ `{strict: true}`

---

### åè®®ç±»å‹

#### 17. http/request - HTTP è¯·æ±‚è¡Œ
```wpl
http/request":http_req
```
- **æ ¼å¼**ï¼š`"GET /api/users HTTP/1.1"`
- **æå–**ï¼šæ–¹æ³• + è·¯å¾„ + åè®®ç‰ˆæœ¬

#### 18. http/status - HTTP çŠ¶æ€ç 
```wpl
http/status:http_status
```
- **æ ¼å¼**ï¼š`200`ã€`404`ã€`500` ç­‰

#### 19. http/agent - User-Agent
```wpl
http/agent":user_agent
```
- **æ ¼å¼**ï¼š`"Mozilla/5.0..."`
- **ç”¨é€”**ï¼šæµè§ˆå™¨æ ‡è¯†

#### 20. http/method - HTTP æ–¹æ³•
```wpl
http/method":http_method
```
- **æ”¯æŒ**ï¼š`GET`ã€`POST`ã€`PUT`ã€`DELETE` ç­‰

---

### ç¼–ç ç±»å‹

#### 21. hex - åå…­è¿›åˆ¶
```wpl
hex:hex_data
```
- **æ ¼å¼**ï¼š`0x1A2B` æˆ– `1A2B`
- **è¾“å‡º**ï¼šåå…­è¿›åˆ¶å­—ç¬¦ä¸²

#### 22. base64 - Base64 ç¼–ç 
```wpl
base64:base64_data
```
- **æ ¼å¼**ï¼š`YmFzZTY0ZGF0YQ==`
- **è¾“å‡º**ï¼šBase64 ç¼–ç å­—ç¬¦ä¸²

---

### ç‰¹æ®Šç±»å‹

#### 23. sn - åºåˆ—å·
```wpl
sn:serial
```
- **æ ¼å¼**ï¼šå­—æ¯æ•°å­—ç»„åˆï¼Œå¦‚ `ABC123XYZ`
- **ç”¨é€”**ï¼šè®¾å¤‡åºåˆ—å·ã€è®¢å•å·ç­‰

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### å­¦ä¹ è·¯å¾„

1. **ç¬¬ä¸€æ­¥**ï¼šå…ˆç†è§£åŸºç¡€ç±»å‹ï¼ˆ`digit`ã€`chars`ã€`ip`ï¼‰
2. **ç¬¬äºŒæ­¥**ï¼šæŒæ¡æ—¶é—´ç±»å‹ï¼ˆæ ¹æ®æ—¥å¿—æ ¼å¼é€‰æ‹©ï¼‰
3. **ç¬¬ä¸‰æ­¥**ï¼šå­¦ä¹ ç»“æ„åŒ–ç±»å‹ï¼ˆ`json`ã€`kvarr`ï¼‰
4. **ç¬¬å››æ­¥**ï¼šäº†è§£åè®®ç±»å‹ï¼ˆ`http/*`ï¼‰

### å®æˆ˜å»ºè®®

- **å¿«é€ŸæŸ¥é˜…**ï¼šé‡åˆ°ä¸è®¤è¯†çš„æ•°æ®æ ¼å¼ï¼Œå…ˆåœ¨æœ¬é¡µé¢æœç´¢
- **å¤åˆ¶å³ç”¨**ï¼šç›´æ¥å¤åˆ¶å¯¹åº”ç±»å‹çš„è¯­æ³•åˆ°ä½ çš„è§„åˆ™ä¸­
- **ç±»å‹ç»„åˆ**ï¼šå¤šç§ç±»å‹å¯ä»¥è‡ªç”±ç»„åˆä½¿ç”¨

### å¸¸è§ç»„åˆ

```wpl
// Web æ—¥å¿—
(ip, time/clf<[,]>, http/request", http/status, digit)

// API æ—¥å¿—
(time_3339, chars, json(chars@user, digit@code))

// é˜²ç«å¢™æ—¥å¿—
(ip, port, time, kvarr)
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **å¿«é€Ÿå…¥é—¨**ï¼š[01-quickstart.md](./01-quickstart.md) - 5 åˆ†é’Ÿä¸Šæ‰‹
- **æ ¸å¿ƒæ¦‚å¿µ**ï¼š[02-core-concepts.md](./02-core-concepts.md) - æ·±å…¥ç†è§£ç±»å‹ç³»ç»Ÿ
- **å®æˆ˜æŒ‡å—**ï¼š[03-practical-guide.md](./03-practical-guide.md) - æŒ‰ä»»åŠ¡æŸ¥æ‰¾è§£å†³æ–¹æ¡ˆ
- **è¯­è¨€å‚è€ƒ**ï¼š[04-language-reference.md](./04-language-reference.md) - å®Œæ•´ç±»å‹åˆ—è¡¨
- **å‡½æ•°å‚è€ƒ**ï¼š[05-functions-reference.md](./05-functions-reference.md) - æ‰€æœ‰å‡½æ•°è¯¦è§£

---

## ğŸ“Œ å¿«é€Ÿå¯¼èˆª

| æˆ‘æƒ³... | æŸ¥çœ‹ç« èŠ‚ |
|---------|---------|
| æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ä»£ç  | [å®Œæ•´ç¤ºä¾‹](#-å®Œæ•´ç¤ºä¾‹) |
| äº†è§£æŸä¸ªç±»å‹è¯¦æƒ… | [ç±»å‹è¯¦è§£](#-ç±»å‹è¯¦è§£) |
| å­¦ä¹ å¦‚ä½•ä½¿ç”¨ | [ä½¿ç”¨å»ºè®®](#-ä½¿ç”¨å»ºè®®) |
| æŸ¥æ‰¾å¸¸è§ç»„åˆ | [å¸¸è§ç»„åˆ](#å¸¸è§ç»„åˆ) |

---

**æç¤º**ï¼šå°†æœ¬é¡µé¢åŠ å…¥ä¹¦ç­¾ï¼Œä½œä¸º WPL ç±»å‹ç³»ç»Ÿçš„é€ŸæŸ¥æ‰‹å†Œï¼
