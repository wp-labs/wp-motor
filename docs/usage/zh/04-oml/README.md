# OML å¯¹è±¡æ¨¡å‹è¯­è¨€

OML (Object Modeling Language) æ˜¯ Warp Parse ä½¿ç”¨çš„æ•°æ®è½¬æ¢è¯­è¨€ï¼Œç”¨äºå¯¹ WPL è§£æåçš„ç»“æ„åŒ–æ•°æ®è¿›è¡Œè½¬æ¢ã€èšåˆå’Œå¯ŒåŒ–ã€‚

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æŒ‰å­¦ä¹ è·¯å¾„

```
ğŸ†• æ–°æ‰‹å…¥é—¨
   â†“
01-quickstart.md â”€â”€â”€â”€â”€â”€â”€â”€â†’ 5åˆ†é’Ÿä¸Šæ‰‹ï¼Œå¤åˆ¶å³ç”¨
   â†“
07-complete-example.md â”€â”€â†’ ğŸŒŸ å®Œæ•´åŠŸèƒ½æ¼”ç¤ºï¼ˆå¼ºçƒˆæ¨èï¼‰
   â†“
02-core-concepts.md â”€â”€â”€â”€â”€â†’ ç†è§£è®¾è®¡ç†å¿µå’Œæ ¸å¿ƒæ¦‚å¿µ
   â†“
03-practical-guide.md â”€â”€â”€â†’ æŒ‰ä»»åŠ¡æŸ¥æ‰¾è§£å†³æ–¹æ¡ˆ
   â†“
04-functions-reference.md â†’ æŸ¥é˜…å‡½æ•°
   â†“
05-integration.md â”€â”€â”€â”€â”€â”€â”€â†’ é›†æˆåˆ°æ•°æ®æµ
```

### æŒ‰ç”¨æˆ·è§’è‰²

| æˆ‘æ˜¯... | æ¨èé˜…è¯» |
|---------|---------|
| **OML æ–°æ‰‹** | [01-quickstart.md](./01-quickstart.md) â†’ [07-complete-example.md](./07-complete-example.md) |
| **æ—¥å¸¸ä½¿ç”¨è€…** | [03-practical-guide.md](./03-practical-guide.md) - æŒ‰ä»»åŠ¡æŸ¥æ‰¾ |
| **å¼€å‘è€…/é›†æˆ** | [07-complete-example.md](./07-complete-example.md) + [04-functions-reference.md](./04-functions-reference.md) |
| **ç³»ç»Ÿé›†æˆ** | [05-integration.md](./05-integration.md) - WPL/OML/Sink å…³è” |

### æŒ‰ä»»åŠ¡æŸ¥æ‰¾

| æˆ‘æƒ³... | æŸ¥çœ‹æ–‡æ¡£ |
|---------|---------|
| ğŸš€ å¿«é€Ÿä¸Šæ‰‹ | [01-quickstart.md](./01-quickstart.md) |
| ğŸŒŸ æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ | [07-complete-example.md](./07-complete-example.md) |
| ğŸ’¡ ç†è§£æ¦‚å¿µ | [02-core-concepts.md](./02-core-concepts.md) |
| ğŸ“ æå–å­—æ®µ | [03-practical-guide.md Â§ æ•°æ®æå–](./03-practical-guide.md#æ•°æ®æå–) |
| ğŸ”„ ç±»å‹è½¬æ¢ | [03-practical-guide.md Â§ æ•°æ®è½¬æ¢](./03-practical-guide.md#æ•°æ®è½¬æ¢) |
| ğŸ“¦ åˆ›å»ºå¯¹è±¡/æ•°ç»„ | [03-practical-guide.md Â§ æ•°æ®èšåˆ](./03-practical-guide.md#æ•°æ®èšåˆ) |
| âœ… æ¡ä»¶åˆ¤æ–­ | [03-practical-guide.md Â§ æ¡ä»¶å¤„ç†](./03-practical-guide.md#æ¡ä»¶å¤„ç†) |
| ğŸ” SQL æŸ¥è¯¢ | [03-practical-guide.md Â§ æ•°æ®å¯ŒåŒ–](./03-practical-guide.md#æ•°æ®å¯ŒåŒ–-sql-æŸ¥è¯¢) |
| âš™ï¸ æŸ¥æŸä¸ªå‡½æ•° | [04-functions-reference.md](./04-functions-reference.md) |
| ğŸ”— é›†æˆåˆ°æµæ°´çº¿ | [05-integration.md](./05-integration.md) |
| ğŸ“– æŸ¥è¯­æ³•è§„åˆ™ | [06-grammar-reference.md](./06-grammar-reference.md) |

---

## ğŸ“– æ–‡æ¡£åˆ—è¡¨

| æ–‡æ¡£ | å†…å®¹ | é€‚åˆäººç¾¤ |
|------|------|---------|
| [01-quickstart.md](./01-quickstart.md) | 5 åˆ†é’Ÿå¿«é€Ÿå…¥é—¨ + 3 ä¸ªæœ€å¸¸ç”¨æ“ä½œ | æ‰€æœ‰äºº |
| [ğŸŒŸ 07-complete-example.md](./07-complete-example.md) | å®Œæ•´åŠŸèƒ½æ¼”ç¤ºï¼ˆå¼ºçƒˆæ¨èï¼‰ | æ‰€æœ‰äºº |
| [02-core-concepts.md](./02-core-concepts.md) | è®¾è®¡ç†å¿µ + ç±»å‹ç³»ç»Ÿ + è¯»å–è¯­ä¹‰ | æƒ³æ·±å…¥ç†è§£çš„ç”¨æˆ· |
| [03-practical-guide.md](./03-practical-guide.md) | æŒ‰ä»»åŠ¡ç»„ç»‡çš„å®æˆ˜ç¤ºä¾‹ | æ—¥å¸¸ä½¿ç”¨è€… |
| [04-functions-reference.md](./04-functions-reference.md) | æ‰€æœ‰å‡½æ•°çš„æ ‡å‡†åŒ–å‚è€ƒ | å¼€å‘è€… |
| [05-integration.md](./05-integration.md) | WPL/OML/Sink é›†æˆæŒ‡å— | ç³»ç»Ÿé›†æˆè€… |
| [06-grammar-reference.md](./06-grammar-reference.md) | EBNF å½¢å¼åŒ–è¯­æ³•å®šä¹‰ | ç¼–è¯‘å™¨å¼€å‘è€… |

---

## âš¡ å¿«é€Ÿç¤ºä¾‹

### åŸºç¡€å­—æ®µæå–

```oml
name : nginx_access
rule : /nginx/access_log
---
user_id = read(user_id) ;
uri = read(request_uri) ;
status : digit = read(status) ;
```

### æ•°æ®èšåˆ

```oml
name : system_metrics
rule : /system/metrics
---
metrics : obj = object {
    hostname : chars = read(hostname) ;
    cpu : float = read(cpu_usage) ;
    memory : float = read(mem_usage) ;
} ;
```

### æ¡ä»¶å¤„ç†

```oml
name : log_classifier
rule : /app/logs
---
level = match read(status_code) {
    in (digit(200), digit(299)) => chars(success) ;
    in (digit(400), digit(499)) => chars(client_error) ;
    in (digit(500), digit(599)) => chars(server_error) ;
    _ => chars(unknown) ;
} ;
```

### ç®¡é“è½¬æ¢

```oml
name : data_transform
rule : /data/raw
---
# æ—¶é—´è½¬æ—¶é—´æˆ³
ts = read(event_time) | Time::to_ts_zone(0, ms) ;

# URL è§£æ
domain = read(url) | url(domain) ;
path = read(url) | url(path) ;

# Base64 è§£ç 
decoded = read(base64_data) | base64_decode(Utf8) ;
```

### SQL æ•°æ®å¯ŒåŒ–

```oml
name : user_enrichment
rule : /app/user_activity
---
user_id = read(user_id) ;

# ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
user_name, user_level =
    select name, level
    from users
    where id = read(user_id) ;
```

æ›´å¤šç¤ºä¾‹è¯·æŸ¥çœ‹ï¼š[ğŸŒŸ å®Œæ•´åŠŸèƒ½ç¤ºä¾‹](./07-complete-example.md) å’Œ [å®æˆ˜æŒ‡å—](./03-practical-guide.md)

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **å£°æ˜å¼**ï¼šæè¿°"æƒ³è¦ä»€ä¹ˆ"ï¼Œè€Œé"æ€ä¹ˆåš"
- **ç±»å‹å®‰å…¨**ï¼š8 ç§æ•°æ®ç±»å‹ï¼Œè‡ªåŠ¨æ¨æ–­æˆ–æ˜¾å¼å£°æ˜
- **WPL å…³è”**ï¼šé€šè¿‡ `rule` å­—æ®µåŒ¹é… WPL è§£æè§„åˆ™
- **è¯»å–æ¨¡å¼**ï¼šreadï¼ˆéç ´åæ€§ï¼‰vs takeï¼ˆç ´åæ€§ï¼‰
- **å¼ºå¤§çš„ç®¡é“**ï¼šé“¾å¼è½¬æ¢ï¼ˆæ—¶é—´/ç¼–è§£ç /URL è§£æç­‰ï¼‰
- **æ¡ä»¶åŒ¹é…**ï¼šmatch è¡¨è¾¾å¼æ”¯æŒèŒƒå›´ã€å¦å®šã€å¤šæºåŒ¹é…
- **æ•°æ®èšåˆ**ï¼šobjectï¼ˆå¯¹è±¡ï¼‰å’Œ collectï¼ˆæ•°ç»„ï¼‰
- **SQL é›†æˆ**ï¼šç›´æ¥æŸ¥è¯¢æ•°æ®åº“è¿›è¡Œæ•°æ®å¯ŒåŒ–

---

## ğŸ”— WPL ä¸ OML å…³è”

OML é€šè¿‡ `rule` å­—æ®µä¸ WPL çš„ `package/rule` å»ºç«‹å…³è”ï¼š

```
åŸå§‹æ•°æ®
    â†“
[WPL è§£æ] â†’ ç”Ÿæˆç»“æ„åŒ–æ•°æ® + rule æ ‡è¯†
    â†“
æ•°æ®æºå¸¦: rule = "/nginx/access_log"
    â†“
[æŸ¥æ‰¾åŒ¹é…çš„ OML] â†’ åŒ¹é… rule å­—æ®µ
    â†“
[æ‰§è¡Œ OML è½¬æ¢]
    â†“
[è¾“å‡ºåˆ° Sink]
```

**ç¤ºä¾‹**ï¼š

WPL è§„åˆ™ï¼š
```wpl
package nginx {
    rule access_log {
        (ip:client_ip, chars:uri, digit:status)
    }
}
```

OML é…ç½®ï¼š
```oml
name : nginx_handler
rule : /nginx/access_log    # åŒ¹é… WPL çš„ package/rule
---
client : ip = read(client_ip) ;
uri : chars = read(uri) ;
status : digit = read(status) ;
```

---

## ğŸ’¬ å¿«é€Ÿå¸®åŠ©

### å¸¸è§é—®é¢˜

**Q: ä»å“ªé‡Œå¼€å§‹å­¦ä¹ ï¼Ÿ**
A: ä» [01-quickstart.md](./01-quickstart.md) å¼€å§‹ï¼Œç„¶åæŸ¥çœ‹ [ğŸŒŸ å®Œæ•´åŠŸèƒ½ç¤ºä¾‹](./07-complete-example.md)ã€‚

**Q: å¦‚ä½•å°† OML ä¸ WPL å…³è”ï¼Ÿ**
A: ä½¿ç”¨ `rule` å­—æ®µåŒ¹é… WPL çš„ `package/rule` å€¼ï¼Œè¯¦è§ [05-integration.md](./05-integration.md)ã€‚

**Q: read å’Œ take æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
A: `read` æ˜¯éç ´åæ€§çš„ï¼ˆå¯é‡å¤è¯»å–ï¼‰ï¼Œ`take` æ˜¯ç ´åæ€§çš„ï¼ˆè¯»å–åç§»é™¤ï¼‰ï¼Œè¯¦è§ [02-core-concepts.md](./02-core-concepts.md#è¯»å–è¯­ä¹‰read-vs-take)ã€‚

**Q: æŸä¸ªå‡½æ•°æ€ä¹ˆç”¨ï¼Ÿ**
A: æŸ¥çœ‹ [04-functions-reference.md](./04-functions-reference.md) æˆ– [ğŸŒŸ å®Œæ•´åŠŸèƒ½ç¤ºä¾‹](./07-complete-example.md)ã€‚

**Q: å¦‚ä½•è°ƒè¯• OML è½¬æ¢ï¼Ÿ**
A: å‚è€ƒ [05-integration.md Â§ æ•…éšœæ’æŸ¥](./05-integration.md#æ•…éšœæ’æŸ¥)ã€‚

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [WPL è§„åˆ™è¯­è¨€](../03-wpl/README.md) - æ•°æ®è§£æ
- [Sink é…ç½®](../05-connectors/02-sinks/README.md) - æ•°æ®è¾“å‡º
- [é…ç½®æŒ‡å—](../02-config/README.md) - ç³»ç»Ÿé…ç½®

---

**å¼€å§‹å­¦ä¹ ï¼š** [01-quickstart.md](./01-quickstart.md) - 5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨  
**å®Œæ•´ç¤ºä¾‹ï¼š** [ğŸŒŸ 07-complete-example.md](./07-complete-example.md) - æ‰€æœ‰åŠŸèƒ½æ¼”ç¤º
