# WPL ä½¿ç”¨æŒ‡å—

æœ¬ç›®å½•åŒ…å« WP-Motor WPL (WP Language) è¯­è¨€çš„ä½¿ç”¨æ–‡æ¡£ã€‚

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### æ ¸å¿ƒæ¦‚å¿µ

- **[å‡½æ•°ç´¢å¼•](./function_index.md)** - æ‰€æœ‰å¯ç”¨ field function çš„å®Œæ•´åˆ—è¡¨
- **[å­—æ®µå¼•ç”¨](./field_reference.md)** - å­—æ®µè®¿é—®å’Œå¼•ç”¨è¯´æ˜
- **[åˆ†éš”ç¬¦](./separator.md)** - æ—¥å¿—åˆ†éš”ç¬¦é…ç½®æŒ‡å—

### å‡½æ•°è¯¦ç»†æ–‡æ¡£

#### å­—ç¬¦ä¸²å¤„ç†

- **[chars_replace](./chars_replace.md)** - å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°
  - åŸºæœ¬ç”¨æ³•ï¼š`chars_replace(target, replacement)`
  - æ”¯æŒå¸¦å¼•å·å­—ç¬¦ä¸²ï¼ˆå¤„ç†é€—å·ã€ç©ºæ ¼ç­‰ç‰¹æ®Šå­—ç¬¦ï¼‰
  - å…¨å±€æ›¿æ¢ã€å¤§å°å†™æ•æ„Ÿ

- **[regex_match](./regex_match.md)** - æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å‡½æ•° â­ æ–°å¢
  - åŸºæœ¬ç”¨æ³•ï¼š`regex_match('pattern')`
  - æ”¯æŒå®Œæ•´çš„ Rust regex è¯­æ³•
  - **é‡è¦**ï¼šä½¿ç”¨å•å¼•å·é¿å…è½¬ä¹‰é—®é¢˜
  - é€‚åˆå¤æ‚æ¨¡å¼åŒ¹é…åœºæ™¯

#### æ•°å€¼å¤„ç†

- **[digit_range](./digit_range.md)** - æ•°å€¼èŒƒå›´æ£€æŸ¥å‡½æ•° â­ æ–°å¢
  - åŸºæœ¬ç”¨æ³•ï¼š`digit_range(begin, end)`
  - ç®€å•é«˜æ•ˆçš„é—­åŒºé—´æ£€æŸ¥
  - é€‚åˆ HTTP çŠ¶æ€ç ã€ç«¯å£å·ã€æ€§èƒ½æŒ‡æ ‡ç­‰åœºæ™¯

### ç¤ºä¾‹ä»£ç 

- **[take_quoted_demo.wpl](./take_quoted_demo.wpl)** - å¼•å·å­—ç¬¦ä¸²å¤„ç†ç¤ºä¾‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬æµæ°´çº¿ç»“æ„

```wpl
rule my_rule {
    # 1. é€‰æ‹©å­—æ®µ
    | take(field_name)

    # 2. æ¡ä»¶æ£€æŸ¥
    | chars_has(expected_value)

    # 3. è½¬æ¢å¤„ç†
    | chars_replace(old, new)
}
```

### å¸¸ç”¨æ¨¡å¼

#### æ¨¡å¼ 1ï¼šæ—¥å¿—çº§åˆ«è¿‡æ»¤

```wpl
rule error_filter {
    | take(level)
    | chars_in([ERROR, FATAL, CRITICAL])
}
```

#### æ¨¡å¼ 2ï¼šçŠ¶æ€ç éªŒè¯

```wpl
rule status_validation {
    | take(status_code)
    | digit_range(200, 299)  # 2xx æˆåŠŸçŠ¶æ€ç 
}
```

#### æ¨¡å¼ 3ï¼šå†…å®¹æ¨¡å¼åŒ¹é…

```wpl
rule content_match {
    | take(message)
    | regex_match('(?i)(error|exception|failed)')
}
```

#### æ¨¡å¼ 4ï¼šå¤šæ¡ä»¶ç»„åˆ

```wpl
rule complex_filter {
    # æ£€æŸ¥çŠ¶æ€ç 
    | take(status)
    | digit_range(200, 299)

    # æ£€æŸ¥å“åº”æ—¶é—´
    | take(response_time)
    | digit_range(0, 1000)  # å°äº 1 ç§’

    # æ£€æŸ¥è·¯å¾„
    | take(path)
    | regex_match('^/api/v\d+/')
}
```

## ğŸ“– å‡½æ•°é€‰æ‹©æŒ‡å—

### å­—ç¬¦ä¸²åŒ¹é…

| éœ€æ±‚ | æ¨èå‡½æ•° | ç¤ºä¾‹ |
|------|----------|------|
| ç²¾ç¡®åŒ¹é…å•ä¸ªå€¼ | `chars_has` | `chars_has(ERROR)` |
| åŒ¹é…å¤šä¸ªå›ºå®šå€¼ | `chars_in` | `chars_in([ERROR, FATAL])` |
| å¤æ‚æ¨¡å¼åŒ¹é… | `regex_match` | `regex_match('(?i)error:\d+')` |
| å­—ç¬¦ä¸²æ›¿æ¢ | `chars_replace` | `chars_replace(old, new)` |

### æ•°å€¼åŒ¹é…

| éœ€æ±‚ | æ¨èå‡½æ•° | ç¤ºä¾‹ |
|------|----------|------|
| ç²¾ç¡®åŒ¹é…å•ä¸ªå€¼ | `digit_has` | `digit_has(200)` |
| åŒ¹é…å¤šä¸ªç¦»æ•£å€¼ | `digit_in` | `digit_in([200, 404, 500])` |
| èŒƒå›´æ£€æŸ¥ | `digit_range` | `digit_range(200, 299)` |

### æ€§èƒ½ä¼˜å…ˆçº§

1. **æœ€å¿«**ï¼š`chars_has`, `digit_has` (< 100ns)
2. **å¿«**ï¼š`chars_in`, `digit_in`, `digit_range` (< 1Î¼s)
3. **ä¸­ç­‰**ï¼š`chars_replace`, `base64_decode` (1-10Î¼s)
4. **è¾ƒæ…¢**ï¼š`regex_match` (1-100Î¼sï¼Œå–å†³äºæ¨¡å¼å¤æ‚åº¦)

**å»ºè®®**ï¼šä¼˜å…ˆä½¿ç”¨ç®€å•ä¸“ç”¨å‡½æ•°ï¼Œä»…åœ¨éœ€è¦æ—¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚

## âš ï¸ å¸¸è§é™·é˜±

### 1. regex_match å¼•å·é—®é¢˜

```wpl
# âœ… æ­£ç¡®ï¼šä½¿ç”¨å•å¼•å·
regex_match('^\d+$')

# âŒ é”™è¯¯ï¼šåŒå¼•å·ä¼šå¯¼è‡´è§£æå¤±è´¥
regex_match("^\d+$")  # \d ä¸æ˜¯æœ‰æ•ˆçš„è½¬ä¹‰åºåˆ—
```

### 2. å­—æ®µé€‰æ‹©é—æ¼

```wpl
# âŒ é”™è¯¯ï¼šæ²¡æœ‰é€‰æ‹©å­—æ®µ
chars_replace(old, new)  # ä¼šå¤±è´¥

# âœ… æ­£ç¡®ï¼šå…ˆé€‰æ‹©å­—æ®µ
| take(message)
| chars_replace(old, new)
```

### 3. ç‰¹æ®Šå­—ç¬¦æœªå¼•å·

```wpl
# âŒ é”™è¯¯ï¼šåŒ…å«é€—å·æœªä½¿ç”¨å¼•å·
chars_replace(hello, world, hi)  # è¯­æ³•é”™è¯¯

# âœ… æ­£ç¡®ï¼šä½¿ç”¨å¼•å·
chars_replace("hello, world", hi)
```

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨è°ƒè¯•æ¨¡å¼

```bash
# æŸ¥çœ‹è¯¦ç»†çš„å¤„ç†è¿‡ç¨‹
wp-motor --debug rule.wpl < test.log
```

### 2. é€æ­¥æµ‹è¯•

```wpl
# å…ˆæµ‹è¯•å•ä¸ªæ¡ä»¶
| chars_has(error)

# å†é€æ­¥æ·»åŠ æ›´å¤šæ¡ä»¶
| chars_has(error)
| regex_match('error:\d+')
```

### 3. éªŒè¯å­—æ®µç±»å‹

```wpl
# ä½¿ç”¨ has() ç¡®è®¤å­—æ®µå­˜åœ¨
| has()

# ä½¿ç”¨ç±»å‹ç‰¹å®šçš„æ£€æŸ¥ç¡®è®¤ç±»å‹
| chars_has(any_value)  # ç¡®è®¤æ˜¯å­—ç¬¦ä¸²
| digit_has(0)          # ç¡®è®¤æ˜¯æ•°å­—
```

## ğŸ“ å¼€å‘æŒ‡å—

å¦‚æœä½ æƒ³å¼€å‘æ–°çš„ field functionï¼Œè¯·å‚è€ƒï¼š

- **[Field Function å¼€å‘æŒ‡å—](../../guide/wpl_field_func_development_guide.md)**
  - å®Œæ•´çš„å¼€å‘æµç¨‹
  - ä»£ç ç¤ºä¾‹
  - æµ‹è¯•æ–¹æ³•
  - æœ€ä½³å®è·µ

## ğŸ†• æœ€æ–°æ›´æ–°

### v1.13.1 (2026-02-02)

- â­ **æ–°å¢** `digit_range` å‡½æ•° - æ•°å€¼èŒƒå›´æ£€æŸ¥
- â­ **æ–°å¢** `regex_match` å‡½æ•° - æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
- ğŸ“– å®Œå–„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

### v1.11.0 (2026-01-29)

- â­ **æ–°å¢** `chars_replace` å‡½æ•° - å­—ç¬¦ä¸²æ›¿æ¢
- ğŸ“– å®Œå–„å¼•å·å­—ç¬¦ä¸²å¤„ç†æ–‡æ¡£

## ğŸ“ è·å–å¸®åŠ©

- **Issues**: https://github.com/wp-labs/wp-motor/issues
- **Documentation**: `/docs`
- **Examples**: `/examples`

## ç›¸å…³é“¾æ¥

- [ä¸»æ–‡æ¡£](../../README.md)
- [å¼€å‘æŒ‡å—](../../guide/)
- [é…ç½®å‚è€ƒ](../../dar/)

---

**æç¤º**: ä» [å‡½æ•°ç´¢å¼•](./function_index.md) å¼€å§‹ï¼Œå¿«é€Ÿäº†è§£æ‰€æœ‰å¯ç”¨å‡½æ•°ã€‚
