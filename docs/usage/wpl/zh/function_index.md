# WPL Field Functions å‡½æ•°ç´¢å¼•

æœ¬æ–‡æ¡£åˆ—å‡ºäº† WP-Motor WPL è¯­è¨€ä¸­æ‰€æœ‰å¯ç”¨çš„ field functionï¼ˆå­—æ®µå‡½æ•°ï¼‰ã€‚

## å­—æ®µé€‰æ‹©å‡½æ•° (Field Selectors)

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | æ–‡æ¡£ |
|------|------|------|------|
| `take` | `take(field_name)` | é€‰æ‹©æŒ‡å®šåç§°çš„å­—æ®µä½œä¸ºæ´»åŠ¨å­—æ®µ | - |
| `last` | `last()` | é€‰æ‹©æœ€åä¸€ä¸ªå­—æ®µä½œä¸ºæ´»åŠ¨å­—æ®µ | - |

## å­—ç¬¦ä¸²åŒ¹é…å‡½æ•° (String Matching)

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | æ–‡æ¡£ |
|------|------|------|------|
| `chars_has` | `chars_has(value)` | æ£€æŸ¥å­—ç¬¦ä¸²å­—æ®µæ˜¯å¦ç­‰äºæŒ‡å®šå€¼ | - |
| `chars_not_has` | `chars_not_has(value)` | æ£€æŸ¥å­—ç¬¦ä¸²å­—æ®µæ˜¯å¦ä¸ç­‰äºæŒ‡å®šå€¼ | - |
| `chars_in` | `chars_in([value1, value2, ...])` | æ£€æŸ¥å­—ç¬¦ä¸²å­—æ®µæ˜¯å¦åœ¨å€¼åˆ—è¡¨ä¸­ | - |
| `f_chars_has` | `f_chars_has(target, value)` | æ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦ç­‰äºæŒ‡å®šå€¼ | - |
| `f_chars_not_has` | `f_chars_not_has(target, value)` | æ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦ä¸ç­‰äºæŒ‡å®šå€¼ | - |
| `f_chars_in` | `f_chars_in(target, [values])` | æ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦åœ¨å€¼åˆ—è¡¨ä¸­ | - |
| `starts_with` | `starts_with('prefix')` | æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šå‰ç¼€å¼€å§‹ï¼Œå¦åˆ™è½¬ä¸º ignore | [ğŸ“– è¯¦ç»†æ–‡æ¡£](./starts_with.md) |
| `regex_match` | `regex_match('pattern')` | ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å­—ç¬¦ä¸²å­—æ®µ | [ğŸ“– è¯¦ç»†æ–‡æ¡£](./regex_match.md) |

## æ•°å€¼åŒ¹é…å‡½æ•° (Numeric Matching)

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | æ–‡æ¡£ |
|------|------|------|------|
| `digit_has` | `digit_has(value)` | æ£€æŸ¥æ•°å€¼å­—æ®µæ˜¯å¦ç­‰äºæŒ‡å®šå€¼ | - |
| `digit_in` | `digit_in([value1, value2, ...])` | æ£€æŸ¥æ•°å€¼å­—æ®µæ˜¯å¦åœ¨å€¼åˆ—è¡¨ä¸­ | - |
| `digit_range` | `digit_range(begin, end)` | æ£€æŸ¥æ•°å€¼æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…ï¼ˆé—­åŒºé—´ï¼‰ | [ğŸ“– è¯¦ç»†æ–‡æ¡£](./digit_range.md) |
| `f_digit_has` | `f_digit_has(target, value)` | æ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦ç­‰äºæŒ‡å®šæ•°å€¼ | - |
| `f_digit_in` | `f_digit_in(target, [values])` | æ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦åœ¨æ•°å€¼åˆ—è¡¨ä¸­ | - |

## IP åœ°å€åŒ¹é…å‡½æ•° (IP Matching)

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | æ–‡æ¡£ |
|------|------|------|------|
| `ip_in` | `ip_in([ip1, ip2, ...])` | æ£€æŸ¥ IP åœ°å€æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | - |
| `f_ip_in` | `f_ip_in(target, [ips])` | æ£€æŸ¥æŒ‡å®šå­—æ®µçš„ IP åœ°å€æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | - |

## å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥ (Field Existence)

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | æ–‡æ¡£ |
|------|------|------|------|
| `has` | `has()` | æ£€æŸ¥å½“å‰æ´»åŠ¨å­—æ®µæ˜¯å¦å­˜åœ¨ | - |
| `f_has` | `f_has(target)` | æ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨ | - |

## åŒ…è£…å‡½æ•° (Wrapper Functions)

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | æ–‡æ¡£ |
|------|------|------|------|
| `not` | `not(inner_function)` | åè½¬ï¼ˆå–åï¼‰å†…éƒ¨ç®¡é“å‡½æ•°çš„æˆåŠŸ/å¤±è´¥ç»“æœ | [ğŸ“– è¯¦ç»†æ–‡æ¡£](./not.md) |

## å­—ç¬¦ä¸²è½¬æ¢å‡½æ•° (String Transformation)

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | æ–‡æ¡£ |
|------|------|------|------|
| `json_unescape` | `json_unescape()` | è§£ç  JSON è½¬ä¹‰å­—ç¬¦ï¼ˆ`\n`, `\t`, `\"`, `\\` ç­‰ï¼‰ | - |
| `base64_decode` | `base64_decode()` | Base64 è§£ç å­—ç¬¦ä¸²å­—æ®µ | - |
| `chars_replace` | `chars_replace(target, replacement)` | æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å­ä¸² | [ğŸ“– è¯¦ç»†æ–‡æ¡£](./chars_replace.md) |

## å‡½æ•°åˆ†ç±»æ€»è§ˆ

### æŒ‰åŠŸèƒ½åˆ†ç±»

#### 1. æ¡ä»¶æ£€æŸ¥å‡½æ•°
ç”¨äºæ£€æŸ¥å­—æ®µæ˜¯å¦æ»¡è¶³ç‰¹å®šæ¡ä»¶ï¼Œä¸ä¿®æ”¹å­—æ®µå€¼ã€‚

- å­—ç¬¦ä¸²æ£€æŸ¥ï¼š`chars_has`, `chars_not_has`, `chars_in`, `starts_with`, `regex_match`
- æ•°å€¼æ£€æŸ¥ï¼š`digit_has`, `digit_in`, `digit_range`
- IP æ£€æŸ¥ï¼š`ip_in`
- å­˜åœ¨æ€§æ£€æŸ¥ï¼š`has`

#### 2. è½¬æ¢å‡½æ•°
ä¿®æ”¹å­—æ®µå€¼çš„å‡½æ•°ã€‚

- è§£ç ï¼š`json_unescape`, `base64_decode`
- æ›¿æ¢ï¼š`chars_replace`

#### 3. å­—æ®µé€‰æ‹©å‡½æ•°
ç”¨äºé€‰æ‹©ç‰¹å®šå­—æ®µä½œä¸ºæ´»åŠ¨å­—æ®µã€‚

- `take`: æŒ‰åç§°é€‰æ‹©
- `last`: é€‰æ‹©æœ€åä¸€ä¸ªå­—æ®µ

#### 4. åŒ…è£…å‡½æ•°
åŒ…è£…å…¶ä»–å‡½æ•°ä»¥æ”¹å˜å…¶è¡Œä¸ºã€‚

- `not`: åè½¬å†…éƒ¨å‡½æ•°çš„æˆåŠŸ/å¤±è´¥ç»“æœ

### æŒ‰ç›®æ ‡å­—æ®µæ”¯æŒåˆ†ç±»

#### æ“ä½œå½“å‰æ´»åŠ¨å­—æ®µ
- `chars_has`, `chars_not_has`, `chars_in`, `starts_with`
- `digit_has`, `digit_in`, `digit_range`
- `ip_in`
- `has`
- `json_unescape`, `base64_decode`, `chars_replace`
- `regex_match`

#### å¯æŒ‡å®šç›®æ ‡å­—æ®µ (å¸¦ `f_` å‰ç¼€)
- `f_chars_has`, `f_chars_not_has`, `f_chars_in`
- `f_digit_has`, `f_digit_in`
- `f_ip_in`
- `f_has`

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æµæ°´çº¿

```wpl
rule example_pipeline {
    # 1. é€‰æ‹©å­—æ®µ
    | take(message)

    # 2. æ£€æŸ¥æ¡ä»¶
    | chars_has(error)

    # 3. è½¬æ¢å¤„ç†
    | chars_replace(error, ERROR)
}
```

### å¤æ‚æ¡ä»¶ç»„åˆ

```wpl
rule complex_filter {
    # æ£€æŸ¥çŠ¶æ€ç èŒƒå›´
    | take(status)
    | digit_range(200, 299)  # 2xx æˆåŠŸçŠ¶æ€ç 

    # æ£€æŸ¥æ¶ˆæ¯å†…å®¹
    | take(message)
    | regex_match('(?i)(success|ok|complete)')
}
```

### åˆ†æ”¯é€»è¾‘

```wpl
rule branching_logic {
    # åˆ†æ”¯ 1ï¼šé”™è¯¯æ—¥å¿—
    (
        | take(level)
        | chars_in([ERROR, FATAL])
    )
    |
    # åˆ†æ”¯ 2ï¼šè­¦å‘Šæ—¥å¿—
    (
        | take(level)
        | chars_in([WARN, WARNING])
    )
}
```

## æ€§èƒ½å‚è€ƒ

| å‡½æ•°ç±»å‹ | å…¸å‹æ€§èƒ½ | è¯´æ˜ |
|----------|----------|------|
| å­—æ®µé€‰æ‹© | < 100ns | æå¿«ï¼ŒåŸºäºç´¢å¼•æŸ¥æ‰¾ |
| å­—ç¬¦ä¸²åŒ¹é… | < 1Î¼s | ç®€å•å­—ç¬¦ä¸²æ¯”è¾ƒ |
| æ•°å€¼åŒ¹é… | < 100ns | ç®€å•æ•°å€¼æ¯”è¾ƒ |
| èŒƒå›´æ£€æŸ¥ | < 500ns | çº¿æ€§æ‰«æå¤šä¸ªèŒƒå›´ |
| æ­£åˆ™åŒ¹é… | 1-100Î¼s | å–å†³äºæ¨¡å¼å¤æ‚åº¦ |
| Base64 è§£ç  | 1-10Î¼s | å–å†³äºå­—ç¬¦ä¸²é•¿åº¦ |
| å­—ç¬¦ä¸²æ›¿æ¢ | 1-10Î¼s | å–å†³äºå­—ç¬¦ä¸²é•¿åº¦ |

## æœ€ä½³å®è·µ

### 1. åˆç†ä½¿ç”¨å‡½æ•°ç±»å‹

```wpl
# âœ… æ¨èï¼šç®€å•åŒ¹é…ä½¿ç”¨ chars_has
| chars_has(error)

# âš ï¸ è¿‡åº¦ä½¿ç”¨ï¼šç®€å•åŒ¹é…ä¸éœ€è¦æ­£åˆ™
| regex_match('^error$')  # æ€§èƒ½è¾ƒå·®
```

### 2. ä¼˜å…ˆä½¿ç”¨ä¸“ç”¨å‡½æ•°

```wpl
# âœ… æ¨èï¼šæ•°å€¼èŒƒå›´ä½¿ç”¨ digit_range
| digit_range(200, 299)

# âš ï¸ ä¸æ¨èï¼šç”¨æ­£åˆ™åŒ¹é…æ•°å­—
| regex_match('^2\d{2}$')  # æ€§èƒ½è¾ƒå·®
```

### 3. å…ˆé€‰æ‹©å­—æ®µå†å¤„ç†

```wpl
# âœ… æ­£ç¡®
| take(message)
| chars_replace(old, new)

# âŒ é”™è¯¯ï¼šæ²¡æœ‰æ´»åŠ¨å­—æ®µ
| chars_replace(old, new)  # ä¼šå¤±è´¥
```

### 4. ç»„åˆä½¿ç”¨æ¡ä»¶å‡½æ•°

```wpl
# âœ… æ¨èï¼šå…ˆç”¨ç®€å•æ¡ä»¶è¿‡æ»¤ï¼Œå†ç”¨å¤æ‚æ¡ä»¶
| chars_has(error)          # å¿«é€Ÿè¿‡æ»¤
| regex_match('error:\d+')  # ç²¾ç¡®åŒ¹é…
```

## å‡½æ•°å¯¹æ¯”

### chars_has vs regex_match

| ç‰¹æ€§ | chars_has | regex_match |
|------|-----------|-------------|
| ç”¨é€” | ç²¾ç¡®å­—ç¬¦ä¸²åŒ¹é… | æ¨¡å¼åŒ¹é… |
| æ€§èƒ½ | æå¿« | ç›¸å¯¹è¾ƒæ…¢ |
| çµæ´»æ€§ | ä½ | é«˜ |
| é€‚ç”¨åœºæ™¯ | å·²çŸ¥å›ºå®šå€¼ | å¤æ‚æ¨¡å¼ |

```wpl
# ç®€å•åŒ¹é…ï¼šä½¿ç”¨ chars_has
| chars_has(ERROR)

# å¤æ‚åŒ¹é…ï¼šä½¿ç”¨ regex_match
| regex_match('(?i)error:\s*\d+')
```

### digit_in vs digit_range

| ç‰¹æ€§ | digit_in | digit_range |
|------|----------|-------------|
| ç”¨é€” | ç¦»æ•£å€¼æ£€æŸ¥ | èŒƒå›´æ£€æŸ¥ |
| å‚æ•° | å€¼åˆ—è¡¨ | èŒƒå›´åˆ—è¡¨ |
| é€‚ç”¨åœºæ™¯ | ç‰¹å®šå€¼ï¼ˆå¦‚çŠ¶æ€ç ï¼‰ | è¿ç»­èŒƒå›´ |

```wpl
# ç¦»æ•£å€¼ï¼šä½¿ç”¨ digit_in
| digit_in([200, 404, 500])

# è¿ç»­èŒƒå›´ï¼šä½¿ç”¨ digit_range
| digit_range(200, 299)
```

### ç›®æ ‡å­—æ®µå‡½æ•° vs æ´»åŠ¨å­—æ®µå‡½æ•°

| ç‰¹æ€§ | æ´»åŠ¨å­—æ®µå‡½æ•° | ç›®æ ‡å­—æ®µå‡½æ•° |
|------|-------------|-------------|
| å‰ç¼€ | æ—  | `f_` |
| å­—æ®µé€‰æ‹© | éœ€è¦å…ˆ take | è‡ªåŠ¨é€‰æ‹© |
| æ€§èƒ½ | ç¨å¿« | ç¨æ…¢ï¼ˆéœ€æŸ¥æ‰¾ï¼‰ |
| ä¾¿åˆ©æ€§ | éœ€è¦é¢å¤–æ­¥éª¤ | ä¸€æ­¥åˆ°ä½ |

```wpl
# æ´»åŠ¨å­—æ®µå‡½æ•°
| take(status)
| digit_has(200)

# ç›®æ ‡å­—æ®µå‡½æ•°ï¼ˆæ›´ç®€æ´ï¼‰
| f_digit_has(status, 200)
```

## ç›¸å…³æ–‡æ¡£

- **å¼€å‘æŒ‡å—**: [WPL Field Function å¼€å‘æŒ‡å—](../../guide/wpl_field_func_development_guide.md)
- **å­—æ®µå¼•ç”¨**: [Field Reference](./field_reference.md)
- **åˆ†éš”ç¬¦**: [Separator Guide](./separator.md)

## ç‰ˆæœ¬å†å²

- **1.15.1** (2026-02-07)
  - æ–°å¢ `not()` åŒ…è£…å‡½æ•°
  - ä¿®å¤ `f_chars_not_has` å’Œ `chars_not_has` ç±»å‹æ£€æŸ¥bug

- **1.13.4** (2026-02-03)
  - æ–°å¢ `starts_with` å‡½æ•°
  - å®Œå–„æ–‡æ¡£ä½“ç³»

- **1.13.1** (2026-02-02)
  - æ–°å¢ `digit_range` å‡½æ•°
  - æ–°å¢ `regex_match` å‡½æ•°
  - å®Œå–„æ–‡æ¡£ä½“ç³»

- **1.11.0** (2026-01-29)
  - æ–°å¢ `chars_replace` å‡½æ•°
  - å®Œå–„ Base64 å’Œ JSON è½¬ä¹‰æ”¯æŒ

---

**æç¤º**: é€‰æ‹©åˆé€‚çš„å‡½æ•°ç±»å‹å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚ä¼˜å…ˆä½¿ç”¨ç®€å•çš„ä¸“ç”¨å‡½æ•°ï¼Œä»…åœ¨éœ€è¦å¤æ‚æ¨¡å¼åŒ¹é…æ—¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚
